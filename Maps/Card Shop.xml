<?xml version="1.0" encoding="utf-8"?>
<Level mapname="Card Shop" maptype="Cut Scene: Static" maxplayers="1" musictrack="" winAura="0" nextbattle="" saveable="true" campaign="TIB Card Battler" lastEdited="6/17/2025 7:24:08 PM">

	<Narration>   -PIC:Psy_Academy_Office-  -DIA:Intro-</Narration>

	<Shop costMultiplier="100" baseSalePrice="50" itemQuality="0" qualityVariance="0" foodCostPercent="0">Card Shop
		<Stock type="Consumables" chance="100" num="3">Bandit</Stock>
	</Shop>

	<Script>ShowAllSinglesInBuySingles
		<Action>ForLoop/-ii-,0-LASTINLIST[AllCards],1,Run,RemoveSingleInBuySingles,Index,-ii-</Action>
		<Action>ForLoop/-ii-,0-LASTINLIST[AllCards],1,Run,ShowSingleInBuySingles,Index,-ii-</Action>
	</Script>

	<Script>ShowSingleInBuySingles
		<Action>Log/Showing single information for card at index -VAL:Index-</Action>
		<Action>Run/GetCardDataByIndex,Index,-VAL:Index-</Action>
		<Action>Run/FormatBuyText</Action>
		<Action>AddReply/,,-STR:BuyText-|Run|ShowBuySingleByIndex;;Index;;-VAL:Index-</Action>
	</Script>

	<Script>ShowBuySingleByIndex
		<Action>Run/GetCardDataByIndex,Index,-VAL:Index-</Action>
		<Action>LoadConv/Buy Single</Action>
	</Script>

	<Script>RemoveSingleInBuySingles
		<Action>Log/Removing all singles information for -VAL:Index-</Action>
		<Action>Run/GetCardDataByIndex,Index,-VAL:Index-</Action>
		<Action>Run/FormatBuyText</Action>
		<Action>RemoveReply/,,-STR:BuyText-</Action>
	</Script>

	<Script>FormatBuyText
		<Action>SetString/BuyText,-VAL:RarityCost- SPRITE[Aura] -STR:CardName-</Action>
	</Script>

	<Script>GainPlayerInventoryCards
		<Action>StripItemsFromUnit/Spirit of Card Playing,0,true</Action>
		<Action>Run/_GainPlayerInventoryCardsLoop</Action>
	</Script>

	<Script>_GainPlayerInventoryCardsLoop
		<Action>InvToList/Reserve Supplies,ReservesInv</Action>
		<Action>ForLoop/-InventoryIndex-,0-LASTINLIST[ReservesInv],1,Run,GainCardFromPsyClashCardItem,PsyClashCardItemName,LIST{ReservesInv,-InventoryIndex-},InventoryIndex,-InventoryIndex-</Action>
	</Script>

	<Script>_RemoveItem
		<Action>RemoveItem/-VAL:Roster Number-,-VAL:Inventory Position-</Action>
	</Script>

	<Script>GainCardFromPsyClashCardItem
		<Action>SetVal/MatchingIndex,=:-1</Action>
		<Action>Run/GetCardIndexByName,CardNameToFind,-STR:PsyClashCardItemName-</Action>
		<Action>IfValRun/-VAL:MatchingIndex-,g,-1,_GainCardFromPsyClashCardItemConfirm,PsyClashCardItemName,-STR:PsyClashCardItemName-</Action>
	</Script>

	<Script>_GainCardFromPsyClashCardItemConfirm
		<Action>Run/GetCardDataByIndex,Index,-VAL:MatchingIndex-</Action>
		<Action>AddToList/PlayerDeckInactive,-STR:CardName-</Action>
		<Action>RemoveItem/Reserve Supplies,-VAL:InventoryIndex-</Action>
		<Action>Log/Awarding the player with the -STR:CardName- card, which matched at index -VAL:MatchingIndex-. Removing inventory index -VAL:InventoryIndex-</Action>
	</Script>

	<Dialogue trigger="None/" convID="Intro" r="true">
		<Branch num="0" name="">Sorter/WELCOME. BUY THINGS.
			<Action>AddPortrait/Sorter,Sorter/,left</Action>
			<Reply>Buy Singles/LoadConv/Buy Singles</Reply>
			<Reply>Leave/NewScene/Main Game Loop</Reply>
			<Reply>Neat Shop Window/NamedBranch/OpenShop</Reply>
			<Reply>Show Supplies/NamedBranch/Reserve Supplies</Reply>
		</Branch>
		<Branch num="2" name="OpenShop">Sorter/OF COURSE. WHAT WILL YOU BE PURCHASING TODAY?-NL-(After closing the shop window, each card in your reserves will be added to your inactive Psy Clash cards)
			<Action>ShowInfoBar/</Action>
			<Action>ShowDeckButton/</Action>
			<Action>ShowCalendarButton/</Action>
			<Action>AddCondition/Use Items,true</Action>
			<Action>ShowArmyOverviewButton/</Action>
			<Action>AddCondition/Item Use,true</Action>
			<Action>ShowShop/Card Shop,false</Action>
			<Reply>/</Reply>
		</Branch>
		<Branch num="1" name="">/The player should not see this popup, which should immediately go to 0.
			<Action>GiveItem/Reserve Supplies,Bandit</Action>
			<Action>Run/GainPlayerInventoryCards</Action>
			<Action>GoTo/0</Action>
			<Reply>/</Reply>
		</Branch>
		<Branch num="3" name="Reserve Supplies">Sorter/HERE ARE YOUR THINGS.
			<Action>ShowReserveSupplies/</Action>
			<Reply>Thanks/NewBranch/0</Reply>
		</Branch>
	</Dialogue>

	<Dialogue trigger="None/" convID="Buy Singles" r="true">
		<Branch num="0" name="Buy" showSingleReplies="true">Sorter/BUY SPECIFIC THINGS.
			<Action>AddPortrait/Sorter,Sorter/,left</Action>
			<Action>Run/ShowAllSinglesInBuySingles</Action>
			<Reply>Back/LoadConv/Intro</Reply>
		</Branch>
	</Dialogue>

	<Dialogue trigger="None/" convID="Buy Single" r="true">
		<Branch num="0" name="">Sorter/-STR:CardName-. GOOD CHOICE. THIS -STR:RarityName- WILL COST -VAL:RarityCost-. THIS WOULD BE A GOOD SPOT TO TALK ABOUT THE CARD, PERHAPS.
			<Action>SetVal/Aura,=:-AURA-</Action>
			<Action>IfValGoTo/Aura,l,-VAL:RarityCost-,BRANCH[notenoughaura]</Action>
			<Reply>Buy It!/NamedBranch/Confirm</Reply>
			<Reply>Nevermind!/LoadConv/Buy Singles</Reply>
		</Branch>
		<Branch num="1" name="Confirm">/The player should not see this because it should buy the card and proceed.
			<Action>AddToList/PlayerDeck,-VAL:CardName-</Action>
			<Action>PlaySound/Coins</Action>
			<Action>SetAura/-:-VAL:RarityCost-</Action>
			<Action>LoadConv/Buy Singles</Action>
			<Reply>/</Reply>
		</Branch>
		<Branch num="2" name="notenoughaura">Sorter/-STR:CardName-. THIS -STR:RarityName- WILL COST -VAL:RarityCost-. YOU DO NOT HAVE ENOUGH MONEY.
			<Action>AddPortrait/Sorter,Sorter/,left</Action>
			<Reply>Too bad/LoadConv/Buy Singles</Reply>
		</Branch>
	</Dialogue>

</Level>