<?xml version="1.0" encoding="utf-8"?>
<Level mapname="Card Shop" maptype="Cut Scene: Static" maxplayers="1" musictrack="" winAura="0" nextbattle="" saveable="true" campaign="TIB Card Battler" lastEdited="6/16/2025 5:15:50 PM">

	<Narration>   -PIC:Psy_Academy_Office-  -DIA:Intro-</Narration>

	<Script>ShowAllSinglesInBuySingles
		<Action>ForLoop/-ii-,0-LASTINLIST[AllCards],1,Run,RemoveSingleInBuySingles,Index,-ii-</Action>
		<Action>ForLoop/-ii-,0-LASTINLIST[AllCards],1,Run,ShowSingleInBuySingles,Index,-ii-</Action>
	</Script>

	<Script>ShowSingleInBuySingles
		<Action>Log/Showing single information for card at index -VAL:Index-</Action>
		<Action>Run/GetCardDataByIndex,Index,-VAL:Index-</Action>
		<Action>Run/FormatBuyText</Action>
		<Action>AddReply/,,-STR:BuyText-|Run|ShowBuySingleIndex;;Index;;-VAL:Index-</Action>
	</Script>

	<Script>ShowBuySingleByIndex
		<Action>Run/GetCardDataByIndex,Index,-VAL:Index-</Action>
		<Action>LoadConv/Buy Single</Action>
	</Script>

	<Script>RemoveSingleInBuySingles
		<Action>Log/Removing all singles information for -VAL:Index-</Action>
		<Action>Run/GetCardDataByIndex,Index,-VAL:Index-</Action>
		<Action>Run/FormatBuyText</Action>
		<Action>RemoveReply/,,-STR:BuyText-</Action>
	</Script>

	<Script>FormatBuyText
		<Action>SetString/BuyText,-VAL:RarityCost- SPRITE[Aura] -STR:CardName-</Action>
	</Script>

	<Dialogue trigger="None/" convID="Intro" r="true">
		<Branch num="0" name="">Sorter/WELCOME. BUY THINGS.
			<Action>AddPortrait/Sorter,Sorter/,left</Action>
			<Action>Run/RunAllInitializers</Action>
			<Reply>Buy Singles/LoadConv/Buy Singles</Reply>
			<Reply>Leave/NewScene/Main Game Loop</Reply>
		</Branch>
	</Dialogue>

	<Dialogue trigger="None/" convID="Buy Singles" r="true">
		<Branch num="0" name="Buy" showSingleReplies="true">Sorter/BUY SPECIFIC THINGS. WE SHOULD HAVE THINGS TO INDEX LASTINLIST[AllCards].
			<Action>AddPortrait/Sorter,Sorter/,left</Action>
			<Action>Run/ShowAllSinglesInBuySingles</Action>
			<Reply>Back/LoadConv/Intro</Reply>
		</Branch>
	</Dialogue>

	<Dialogue trigger="None/" convID="Buy Single" r="true">
		<Branch num="0" name="">Sorter/-STR:CardName-. GOOD CHOICE. THIS -STR:RarityName- WILL COST -VAL:RarityCost-.
			<Reply>Buy It!/NamedBranch/Confirm</Reply>
			<Reply>Nevermind!/LoadConv/Buy Singles</Reply>
		</Branch>
		<Branch num="1" name="Confirm">/The player should not see this because it should buy the card and proceed.
			<Action>AddToList/PlayerDeck,-VAL:CardName-</Action>
			<Action>PlaySound/Coins</Action>
			<Action>LoadConv/Buy Singles</Action>
			<Reply>/</Reply>
		</Branch>
	</Dialogue>

</Level>